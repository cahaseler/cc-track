# Plan: 062

Captured: 2025-09-16T13:57:10.270Z

## Plan: Clean up SDK type usage across codebase

### Summary
Based on my audit, I found several type safety issues that need to be addressed:
1. Generic `unknown` type for SDKMessage instead of proper SDK types
2. Missing proper Options typing for the prompt() function
3. Type assertions (`as any`, `as unknown`) in various places
4. CanUseTool implementation that could be improved

### Issues Identified

1. **src/lib/claude-sdk.ts**:
   - Line 16: Uses generic `type SDKMessage = unknown` instead of importing the actual type
   - Line 86-96: prompt() function doesn't use proper Options type from SDK
   - Lines 149, 271, 506: Type assertions to cast stream as AsyncGenerator
   - Line 139: ClaudeResponse['usage'] could be better typed

2. **src/hooks/capture-plan.ts**:
   - Line 271: Uses `as AsyncGenerator<unknown, void>` instead of proper types
   - Line 279: Uses `as SDKMessage` assertion

3. **Test files** (multiple):
   - Various `as any` and `as unknown` assertions for mocks (acceptable in tests per biome config)

4. **src/lib/github-helpers.ts**:
   - Line 140: Uses `as GitHubIssue` assertion (could add validation)
   - Line 175: Complex type assertion for error handling

### Proposed Changes

1. **Import proper SDK types in claude-sdk.ts**:
   - Import `SDKMessage`, `Options`, `Query` from '@anthropic-ai/claude-code'
   - Remove the generic `type SDKMessage = unknown` definition
   - Update prompt() to use proper `Options` type

2. **Fix type assertions**:
   - Replace `stream as AsyncGenerator<SDKMessage, void>` with proper typing
   - Add type guards where appropriate instead of assertions

3. **Improve error handling types**:
   - Create proper error type interfaces for better type safety

4. **Document why certain assertions are safe**:
   - For cases where assertions are necessary, add comments explaining why

### Files to Modify
- `src/lib/claude-sdk.ts` - Main SDK wrapper
- `src/hooks/capture-plan.ts` - Task enrichment hook
- `src/lib/github-helpers.ts` - GitHub API wrapper
- `src/lib/git-helpers.ts` - Git operations wrapper
- `src/lib/diff-summary.ts` - Diff summarization

### Testing Plan
1. Run TypeScript compiler to verify no new errors
2. Run all existing tests to ensure no regressions
3. Run linting to ensure code quality
4. Test actual functionality with a sample task creation

This will improve type safety throughout the codebase and make it easier to catch errors at compile time rather than runtime.