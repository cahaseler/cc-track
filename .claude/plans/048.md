# Plan: 048

Captured: 2025-09-14T12:38:39.352Z

## NPM Global Package Installation System for cc-track

### Overview
Publish cc-track as an npm package with a Bun-compiled binary. The init command creates a slash command that instructs Claude to complete the setup by running cc-track commands.

### Implementation Plan

#### 1. Package Structure for NPM
- **Update package.json**:
  - Add "bin" field: `"bin": { "cc-track": "./dist/cc-track" }`
  - Add "files" field: `["dist/", "templates/", ".claude/commands/"]`
  - Add npm metadata (description, keywords, repository, author, license)
  - Keep version in sync with semantic-release

#### 2. Create Init Command (src/commands/init.ts)
- Creates `.claude/commands/setup-cc-track.md` with instructions for Claude to:
  - Run `bunx cc-track setup-templates` to copy all templates
  - Run `bunx cc-track setup-commands` to copy all slash commands
  - Understand the project structure and populate context files
  - Configure settings.json with appropriate hooks
  - Set up track.config.json based on project needs
- Outputs clear message telling user to restart Claude Code and run `/setup-cc-track`

#### 3. Add Supporting Commands
- **setup-templates command**: 
  - Copies all templates from package install location to .claude/
  - Uses `import.meta.dir` to find templates relative to binary
  - Creates backups if files already exist
  
- **setup-commands command**:
  - Copies all command files from package to .claude/commands/
  - Excludes setup-cc-track.md itself to avoid recursion
  - Preserves any existing custom commands

#### 4. Resource Bundling
- Bundle templates and commands directories with npm package
- Binary reads from `import.meta.dir/../templates/` and `import.meta.dir/../.claude/commands/`
- This works because npm preserves directory structure in global installs

#### 5. NPM Publishing Configuration
- Add `.npmignore`:
  ```
  src/
  tests/
  *.test.ts
  .claude/tasks/
  .claude/plans/
  .github/
  docs/
  ```
- Update build script to ensure binary is compiled before publish
- Add "prepublishOnly" script: `"bun run build"`

#### 6. Installation Flow
```bash
# User installs globally
npm install -g cc-track

# In their project directory
cc-track init
# Creates: .claude/commands/setup-cc-track.md

# User restarts Claude Code and runs: /setup-cc-track

# Claude follows instructions to run:
bunx cc-track setup-templates
bunx cc-track setup-commands
# Then Claude analyzes project and configures everything
```

#### 7. Setup Slash Command Content
The setup-cc-track.md will instruct Claude to:
1. Run the setup commands to get all templates and slash commands
2. Analyze the project (language, framework, structure)
3. Populate product_context.md based on findings
4. Configure system_patterns.md with detected patterns
5. Set up track.config.json enabling appropriate features
6. Update CLAUDE.md with project name and imports
7. Configure settings.json hooks
8. Create initial code_index.md
9. Report back on what was configured

### Benefits
- Single installation method via npm
- Claude handles all configuration transparently
- User sees exactly what's being set up
- Works with existing Bun binary compilation
- No complex bundling or embedding needed

### Technical Implementation
- Bun-compiled binary distributed via npm
- Templates and commands included as package files
- Binary locates resources using import.meta.dir
- Claude-driven setup provides intelligent configuration
- All configuration visible and modifiable by user