# Plan: 010

Captured: 2025-09-10T13:09:35.824Z

## Improve Handling for Non-Task Associated Commits

### Goal
Enhance the stop_review hook to generate meaningful commit messages for work not associated with tasks, and gently suggest task creation when detecting patterns of non-task work.

### Implementation Plan

#### 1. Enhance Stop Review Hook (hooks/stop_review.ts)
- **Modify the review method** when no active task is detected:
  - Instead of returning generic "[wip] Exploratory work", call Claude Haiku to generate a meaningful message
  - Pass the git diff to `generateCommitMessage` from git-helpers
  - Use the generated message with "[exploratory]" prefix instead of "[wip]"

#### 2. Add Non-Task Commit Tracking
- **Create tracking file** `.claude/non_task_commits.json` to track consecutive non-task commits
- **Structure**: `{ count: number, lastCommit: string, commits: string[] }`
- **Reset tracking** when a task is created or when user acknowledges the suggestion

#### 3. Implement Suggestion Logic
- **After commit**, check the count of consecutive non-task commits
- **If count >= 3**, add a gentle system message suggesting task creation:
  - "ðŸ’¡ I notice you've made 3+ commits without an active task. Consider using planning mode (/plan) to create a task for better tracking."
- **Make it non-intrusive**: Just a suggestion, not a block

#### 4. Update Git Helpers (optional enhancement)
- **Enhance generateCommitMessage** function if needed to handle larger diffs better
- Consider adding a specific prompt for exploratory work

### Files to Modify
1. `hooks/stop_review.ts` - Main changes for commit message generation and tracking
2. `.claude/non_task_commits.json` - New file for tracking (created automatically)
3. Potentially `lib/git-helpers.ts` - Minor enhancements to commit message generation

### Key Features
- âœ… Meaningful commit messages for all work (not just generic "[wip]")
- âœ… Non-intrusive tracking and suggestions
- âœ… Uses existing Haiku integration for cost-effectiveness
- âœ… Resets tracking appropriately
- âœ… Maintains backward compatibility

### Testing Plan
1. Make changes without an active task
2. Verify meaningful commit messages are generated
3. Make 3+ consecutive commits without a task
4. Verify the suggestion appears but doesn't block work
5. Create a task and verify tracking resets