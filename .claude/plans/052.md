# Plan: 052

Captured: 2025-09-15T01:46:44.451Z

## Fix pushCurrentBranch to Handle Diverged Branches Automatically

### Problem
The `pushCurrentBranch` function in `GitHubHelpers` fails when branches have diverged (common with semantic-release adding commits to remote). Currently it just tries `git push -u origin HEAD` which fails if remote has new commits.

### Solution
Update the `pushCurrentBranch` method to:
1. First fetch the latest from remote to detect divergence
2. If branches have diverged, attempt `git pull --rebase`
3. If rebase succeeds (common case with release commits), continue with push
4. If rebase has conflicts, abort rebase and fail with clear error message

### Implementation Plan

1. **Update GitHubHelpers.pushCurrentBranch() method** (src/lib/github-helpers.ts:191-205):
   - Add fetch before push to detect if branches have diverged
   - Check if local branch is behind remote
   - If diverged, attempt `git pull --rebase`
   - If rebase succeeds, proceed with push
   - If rebase fails with conflicts, abort rebase and return clear error
   - Add appropriate logging for each step

2. **Update tests** (src/lib/github-helpers.test.ts:175-191):
   - Add test for successful rebase and push scenario
   - Add test for rebase with conflicts (should abort and fail gracefully)
   - Add test for already up-to-date scenario
   - Test the logging messages for clarity

3. **Update the standalone function wrapper** (src/lib/github-helpers.ts:352-354):
   - No changes needed, it just delegates to the class method

### Technical Details

The new flow will be:
```
1. git fetch origin (to get latest remote state)
2. Check if branches diverged using git status -sb
3. If diverged:
   a. Try: git pull --rebase origin <current-branch>
   b. If successful: continue to push
   c. If conflicts: git rebase --abort and fail with message
4. git push -u origin HEAD
```

This handles the common semantic-release case automatically while failing safely when there are real conflicts that need manual resolution.

### Files to modify:
- `src/lib/github-helpers.ts` - Update pushCurrentBranch method
- `src/lib/github-helpers.test.ts` - Add comprehensive tests for new scenarios