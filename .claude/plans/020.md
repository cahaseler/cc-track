# Plan: 020

Captured: 2025-09-10T19:11:12.875Z

## Plan: PostToolUse Hook for Edit Validation

### Overview
Create a PostToolUse hook that runs TypeScript and Biome checks on files after they're edited via Edit, Write, or MultiEdit tools. If errors are found, they're passed back to Claude for immediate awareness.

### Performance Testing Results
- **TypeScript (tsc --noEmit)**: ~1.3-1.4 seconds per file
- **Biome check**: ~60-160ms per file
- Both tools are fast enough for real-time validation without significant impact

### Implementation Details

#### 1. Create New Hook File: `.claude/hooks/edit_validation.ts`
This hook will:
- Trigger on PostToolUse for Edit, Write, and MultiEdit tools
- Extract the file path from tool_input
- Run configurable TypeScript and/or Biome checks
- Return errors in a formatted message for Claude if any found
- Return silently (continue: true) if no errors

#### 2. Update Configuration Schema
Add to `.claude/cc-pars.config.json`:
```json
{
  "hooks": {
    "edit_validation": {
      "enabled": false,  // Default to disabled for opt-in
      "description": "Runs TypeScript and Biome checks on edited files",
      "typecheck": {
        "enabled": true,
        "command": "bunx tsc --noEmit"
      },
      "lint": {
        "enabled": true,
        "command": "bunx biome check"
      }
    }
  }
}
```

#### 3. Update Settings.json
Add PostToolUse matcher for edit operations:
```json
{
  "PostToolUse": [
    {
      "matcher": "Edit|Write|MultiEdit",
      "hooks": [
        {
          "type": "command",
          "command": "bun run .claude/hooks/edit_validation.ts",
          "timeout": 5000
        }
      ]
    }
  ]
}
```

#### 4. Hook Implementation Strategy
- Check if edit_validation is enabled in config
- Parse tool_input to get file path(s)
- For MultiEdit, extract file_path; for Edit/Write, extract file_path
- Skip non-TypeScript files (check .ts/.tsx extension)
- Run configured checks in parallel for speed
- Format errors concisely for Claude's context
- Use hookSpecificOutput.additionalContext to provide error feedback

#### 5. Error Formatting
Return errors in this format to Claude:
```
TypeScript errors in [filename]:
- Line X: Error message
- Line Y: Error message

Biome issues in [filename]:
- Line X: Issue description
```

#### 6. Configuration Options
Make the hook highly configurable:
- Enable/disable the entire hook
- Enable/disable TypeScript checking separately
- Enable/disable Biome checking separately
- Customize the exact commands that run
- This allows users to adapt to their tooling preferences

### Files to Create/Modify
1. **Create** `.claude/hooks/edit_validation.ts` - The hook implementation
2. **Update** `.claude/cc-pars.config.json` - Add edit_validation configuration
3. **Update** `.claude/settings.json` - Register the PostToolUse hook
4. **Update** `.claude/lib/config.ts` - Add type definitions for new config structure
5. **Update** `.claude/commands/config-cc-pars.md` - Add documentation for new config options

### Benefits
- Immediate feedback on type/lint errors after edits
- Prevents accumulation of errors during development
- Configurable to match project needs
- Fast enough to not impact workflow (< 2 seconds total)
- Opt-in feature that doesn't affect existing users

### Testing Plan
1. Test with various file types (.ts, .tsx, .js, .md)
2. Test with files containing errors
3. Test with clean files
4. Test performance with large files
5. Verify configuration enable/disable works correctly
6. Test with both tools enabled, one enabled, and both disabled