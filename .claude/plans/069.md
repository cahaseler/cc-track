# Plan: 069

Captured: 2025-09-17T12:45:39.312Z

# Fix CodeRabbit/code-review Tests Filesystem Access

## Goal
Stop CodeRabbit/code-review tests from touching the real filesystem so CI (which runs as a user without ~/.local/share/cc-track/logs write access) no longer errors on logger initialization.

## Plan

### 1. Update `src/lib/code-review/coderabbit.test.ts`
- Import `createMockLogger` from `src/test-utils/command-mocks.ts`
- Pass mock logger via the existing deps parameter in all test calls to `performCodeRabbitReview`
- The mock logger will implement the logger interface (debug/info/warn/error/exception) without any filesystem operations

### 2. Update `src/lib/code-review/index.test.ts`
- Add `mock.module('../logger', ...)` to return `{ createLogger: () => createMockLogger() }` before importing the modules
- This prevents the real logger from being created when `performCodeReview` runs
- No changes to production code needed - just mock the logger module in the test

## Testing
- Run `bun test` locally to verify all tests pass
- Run `env HOME=/root bun test src/lib/code-review/coderabbit.test.ts` to simulate CI environment
- Run `env HOME=/root bun test src/lib/code-review/index.test.ts` to verify both files work in CI-like conditions

## Notes
- No changes to production code - only test files are modified
- Uses existing dependency injection for coderabbit.test.ts
- Uses mock.module for index.test.ts to avoid any production changes
- Minimal changes, maximum effectiveness