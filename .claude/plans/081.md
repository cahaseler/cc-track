# Plan: 081

Captured: 2025-09-18T20:10:26.328Z

# Support Custom Test Commands in Prepare Completion Hook

## Problem
The prepare completion hook currently has `bun test` hardcoded in `src/lib/validation.ts`, making it unusable for projects using different test runners (npm test, yarn test, jest, vitest, etc.).

## Solution
Add configurable test command support following the existing patterns for TypeScript and lint commands.

## Changes Required

### 1. Configuration Interface Updates (`src/lib/config.ts`)
- Add `tests?: ValidationConfig` to `EditValidationConfig` interface
- Add tests configuration to `DEFAULT_CONFIG.hooks.edit_validation` with:
  - `enabled: true` (default)
  - `command: 'bun test'` (current default, maintains compatibility)

### 2. Validation Logic Updates (`src/lib/validation.ts`)
- Update `runTests()` function to:
  - Get test config from configuration system
  - Use configured command instead of hardcoded `'bun test'`
  - Check if tests are enabled before running
  - Follow same pattern as `runTypeScriptCheck()` and `runLintCheck()`

### 3. Test Updates
- Update existing tests in `src/lib/validation.test.ts` to:
  - Mock the new test configuration 
  - Verify custom test commands are used correctly
  - Test both enabled/disabled scenarios
- Add specific tests for test command configuration

### 4. Documentation
- Update any configuration documentation to include the new test command option

## Implementation Notes
- Maintains backward compatibility (existing behavior unchanged)
- Follows established patterns for TypeScript and lint configuration
- Uses dependency injection for testability
- Supports disabling tests entirely via `enabled: false`

## Example Configuration
```json
{
  "hooks": {
    "edit_validation": {
      "tests": {
        "enabled": true,
        "command": "npm test"
      }
    }
  }
}
```