# Plan: 056

Captured: 2025-09-15T18:37:23.154Z

## Fix GitHub Actions Deployment Failures with Dependency Injection

### Problem
Task validation tests are failing because they don't inject mocked dependencies, causing the real branch protection logic to block edits on the 'main' branch in CI.

### Solution
Apply the same dependency injection pattern already used in the branch protection tests to the task validation tests.

### Implementation Plan

1. **Reuse existing mock helpers** that are already defined in the file:
   - `createMockGitHelpers(currentBranch)` - already exists
   - `createMockConfig(branchProtectionEnabled, options)` - already exists
   - `createMockLogger()` - already exists

2. **Update each failing task validation test** to inject these mocks:
   ```typescript
   const result = await preToolValidationHook(input, {
     isHookEnabled: () => true,
     claudeSDK: mockSDK,
     logger: createMockLogger(),
     getConfig: () => createMockConfig(false),  // Disable branch protection
     gitHelpers: createMockGitHelpers('feature/test')  // Non-protected branch
   });
   ```

3. **Tests to fix** (8 tests in the task validation section):
   - "allows edits to non-task files"
   - "blocks status change to completed"
   - "blocks weasel words about test failures"
   - "allows legitimate progress updates"
   - "handles Claude SDK errors gracefully"
   - "handles invalid JSON response"
   - "ignores non-Edit/MultiEdit tools"

This follows the established dependency injection pattern and ensures consistent test isolation across the entire test suite.