# Plan: 037

Captured: 2025-09-12T17:17:46.323Z

## Fix GitHub Branch Linking Issue

The issue is in the capture-plan hook where GitHub issues aren't being properly linked to branches/PRs. The current implementation has a flawed logic flow that prevents proper linking when both git_branching and use_issue_branches are enabled.

### Current Problem
- Line 241 only creates issue-linked branches when git_branching is DISABLED (`!gitBranchingEnabled`)
- This is backwards - we want issue branches when GitHub integration is enabled
- The order of operations creates a regular branch first, then an issue, with no linking

### Solution Plan

1. **Reorder operations in capturePlanHook**:
   - Move GitHub issue creation BEFORE git branching
   - Check if issue was created successfully
   - If `use_issue_branches` is enabled AND issue exists, use `gh issue develop` instead of regular branching
   - Skip regular git branching if issue branch was created

2. **Fix the condition logic**:
   - Change line 241 from `if (githubConfig?.use_issue_branches && !gitBranchingEnabled)` 
   - To: `if (githubConfig?.use_issue_branches && issue)`
   - This ensures we use issue branches when configured AND an issue was created

3. **Update handleGitHubIntegration function**:
   - Return the issue object (not just the info string) so we can check if it was created
   - This allows the main function to make decisions based on issue creation success

4. **Modify handleGitBranching**:
   - Add a parameter to skip if issue branch was already created
   - Or move the issue branch creation logic into the main flow

5. **Test the changes**:
   - Verify that with both settings enabled, branches are properly linked to issues
   - Ensure PRs created from these branches automatically link to the issues
   - Test fallback behavior when GitHub integration fails

This will ensure proper GitHub integration where issues and branches are linked, making the PR workflow seamless.