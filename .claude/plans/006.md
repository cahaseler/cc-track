# Plan: 006

Captured: 2025-09-10T03:20:52.689Z

## Plan to Fix Statusline and Task Creation

### Issues Found

1. **Statusline Problems**:
   - Regex `ðŸ§  \K\d+` extracts token count (84,339) instead of percentage (42%)
   - Shows unnecessary block costs and timings
   - Too many emojis (robot, money bag, leaf, task)
   - Missing git branch display
   - Looking for wrong task file (active_task.md instead of parsing CLAUDE.md)

2. **Task Creation Bug**:
   - capture_plan hook runs on PreToolUse, creating tasks before plan approval
   - Should either run PostToolUse or check if plan was actually approved

### Proposed Changes

1. **Fix statusline.sh**:
   ```bash
   # Simpler format: Opus | $X.XX today | $X/hr | 84k (42%) | master | TASK_005
   
   # Extract task from CLAUDE.md's Active Task line
   TASK=$(grep "^@.claude/tasks/" CLAUDE.md | sed 's/.*\/\(TASK_[0-9]*\)\.md/\1/')
   
   # Get git branch simply
   BRANCH=$(git branch --show-current 2>/dev/null || echo "no-git")
   
   # Use ccusage output as-is, no regex extraction needed
   # Remove emojis, keep data clean
   ```

2. **Fix capture_plan hook**:
   - Change from PreToolUse to PostToolUse hook
   - OR add logic to check if the plan was approved before creating task

3. **Clean up abandoned TASK_005**:
   - Delete the file
   - Update CLAUDE.md back to no_active_task.md