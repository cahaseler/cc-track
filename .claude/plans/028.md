# Plan: 028

Captured: 2025-09-11T21:42:33.571Z

## Fix TypeScript Test File Type Checking

### Problem Summary
- **139 TypeScript errors** across test files that have been accumulating unnoticed
- Test files were excluded from TypeScript compilation in tsconfig.json
- Pre-push hooks and local TypeScript checks were passing because they ignored test files
- We pushed code with type errors to production

### Error Distribution
- `stop-review.test.ts`: 45 errors (worst offender)
- `capture-plan.test.ts`: 26 errors
- `pre-compact.test.ts`: 19 errors
- `edit-validation.test.ts`: 16 errors
- `statusline.test.ts`: 15 errors
- `logger.test.ts`: 7 errors
- `post-compact.test.ts`: 7 errors
- `git-helpers.test.ts`: 3 errors
- `github-helpers.test.ts`: 1 error

### Common Error Patterns
1. **TS2345 (69 errors)**: Mock objects not matching expected parameter types
2. **TS2322 (51 errors)**: Type assignments between mocks and actual types
3. **TS6133 (5 errors)**: Unused variables
4. **TS2739 (5 errors)**: Missing properties in type literals
5. Other minor issues (12 errors)

### Root Causes
1. Mock functions have incorrect signatures (e.g., `Mock<() => string>` instead of `Mock<(cmd: string) => string>`)
2. Mock objects missing required properties
3. Dependency injection interfaces changed but test mocks weren't updated
4. Type assertions and casts done incorrectly

### Fix Strategy

#### Phase 1: Infrastructure (Immediate)
1. Keep tsconfig.json already updated (test files now included)
2. Add `test:typecheck` script to package.json
3. Update pre-push hook to explicitly check test files

#### Phase 2: Fix Critical Files (Priority Order)
1. **stop-review.test.ts** (45 errors) - Fix mock signatures for execSync, fileOps
2. **capture-plan.test.ts** (26 errors) - Fix fileOps and execSync mocks
3. **pre-compact.test.ts** (19 errors) - Fix ErrorPatternExtractor mocks
4. **edit-validation.test.ts** (16 errors) - Fix validation dependency mocks
5. **statusline.test.ts** (15 errors) - Fix StatusLineDeps mock structure

#### Phase 3: Fix Remaining Files
6. Fix logger.test.ts (7 errors)
7. Fix post-compact.test.ts (7 errors)
8. Fix git-helpers.test.ts (3 errors)
9. Fix github-helpers.test.ts (1 error)

#### Phase 4: Prevention
1. Add GitHub Actions check for test TypeScript
2. Update developer documentation
3. Consider stricter tsconfig for tests

### Implementation Steps
1. Create helper functions for common mock patterns
2. Fix mock signatures to match actual function types
3. Add missing properties to mock objects
4. Use proper type assertions where needed
5. Test each file as we fix it
6. Commit fixes in logical groups

### Success Criteria
- `bunx tsc --noEmit` returns 0 errors
- All tests still pass
- Pre-push hook catches test type errors
- CI/CD validates test types