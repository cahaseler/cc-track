# Plan: 065

Captured: 2025-09-16T23:04:30.687Z

## Plan: Fix Default Branch Assumptions

I've identified several places where the code assumes hardcoded default branch names ("main" or "master"). Here's my plan to fix them:

### Issues Found:
1. **GitHelpers.getDefaultBranch()** - Currently tries remote tracking, then checks for "main", then "master", finally defaults to "main"
2. **capture-plan.ts** - Hardcodes check for `currentBranch !== 'main' && currentBranch !== 'master'`
3. **config.ts** - Default protected branches are hardcoded as `['main', 'master']`
4. **pre-tool-validation.ts** - Falls back to hardcoded `['main', 'master']` if not configured

### Changes to Make:

1. **Improve GitHelpers.getDefaultBranch()** to be more robust:
   - Keep existing remote HEAD detection (already good)
   - If no remote, use `git config init.defaultBranch` to get user's configured default
   - Only fall back to checking for "main"/"master" existence as last resort

2. **Update capture-plan.ts**:
   - Replace hardcoded check with `currentBranch !== gitHelpers.getDefaultBranch(projectRoot)`

3. **Update config.ts**:
   - Change default protected branches to dynamically include the actual default branch
   - Will require making the config initialization aware of the project's default branch

4. **Update pre-tool-validation.ts**:
   - Use GitHelpers to get actual default branch for fallback instead of hardcoded array

5. **Update tests**:
   - Ensure tests properly mock getDefaultBranch() where needed
   - Tests already mostly do this correctly

This will ensure the code works with any default branch name (like "develop", "trunk", etc.) without assumptions.