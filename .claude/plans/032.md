# Plan: 032

Captured: 2025-09-12T11:29:38.658Z

## Plan: Make Log Directory Configurable and Move Outside Project

### Problem
Currently, logs are written to `.claude/logs/` within the project directory, causing VS Code to send file change notifications to Claude Code for every log write, wasting tokens with unnecessary context updates.

### Solution Overview
Make the log directory configurable via `track.config.json` and default to a system-appropriate location outside the project directory to avoid file watcher notifications.

### Implementation Steps

#### 1. Update Configuration Structure
- Add `logging.directory` field to track.config.json
- Update InternalConfig interface in config.ts to include logging configuration
- Add LoggingConfig interface with all logging settings including directory
- Update DEFAULT_CONFIG to include sensible logging defaults

#### 2. Determine Default Log Location
Use platform-appropriate directories following XDG Base Directory spec:
- **Linux/WSL**: `~/.local/share/cc-track/logs/` (or `$XDG_DATA_HOME/cc-track/logs/` if set)
- **macOS**: `~/Library/Logs/cc-track/`
- **Windows**: `%LOCALAPPDATA%\cc-track\logs\`
- **Fallback**: `~/.cc-track/logs/` if platform detection fails

#### 3. Update Logger Implementation
- Modify `Logger` constructor to accept log directory from config
- Update `findLogDir()` to:
  1. Check for configured directory in track.config.json
  2. Fall back to system default location
  3. Never default to project directory
- Add method to expand environment variables and tilde in paths
- Ensure directory creation handles absolute paths correctly

#### 4. Update Logger Tests
- Add tests for configurable log directory
- Test environment variable expansion
- Test platform-specific default selection
- Ensure backward compatibility for explicit logDir parameter

#### 5. Migration Support
- Add one-time migration check to move existing logs from `.claude/logs/` to new location
- Update `.gitignore` to exclude `.claude/logs/` if it still exists
- Document the change in system_patterns.md

#### 6. Update Documentation
- Add logging.directory to track.config.json in existing projects
- Document the change and reasoning
- Note that logs are now outside project to avoid VS Code notifications

### Benefits
1. **Eliminates token waste** from file change notifications
2. **Follows platform conventions** for application logs
3. **Keeps project directory clean** - logs aren't project files
4. **Configurable** for users with specific requirements
5. **Better for CI/CD** - logs persist across project cleans

### Files to Modify
- `src/lib/logger.ts` - Core implementation changes
- `src/lib/logger.test.ts` - Test updates
- `src/lib/config.ts` - Add logging configuration interface
- `.claude/track.config.json` - Add logging.directory config
- `.claude/system_patterns.md` - Document the pattern
- `.gitignore` - Exclude legacy log location

### Testing Plan
1. Verify logs write to new location
2. Test configuration override works
3. Ensure platform detection works correctly
4. Verify migration of existing logs
5. Confirm no file notifications in VS Code