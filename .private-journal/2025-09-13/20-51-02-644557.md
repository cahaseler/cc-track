---
title: "8:51:02 PM - September 13, 2025"
date: 2025-09-14T00:51:02.644Z
timestamp: 1757811062644
---

## Project Notes

TASK_045 Pre-Compact Hook Rewrite - COMPLETED

This was a fascinating pivot from a failed experiment to a useful feature. The original error pattern extraction was actively harmful - it was telling future Claude instances to do dangerous things like "delete test files when they fail" and other nonsensical advice.

Key technical discoveries:
1. Claude SDK was hardcoded to run in tmpdir() - this prevented it from accessing project files. Added cwd parameter support.
2. maxTurns=1 was insufficient - Claude needs to Read files before it can Edit them. Increased to 20.
3. Log parser returns a single string when format='plaintext', not an array as initially assumed.
4. Stop-review hook auto-commits changes, so git diff appears empty even after successful updates.

The rewrite reduced code from ~520 lines to ~175 lines while providing actual value. Now the pre-compact hook automatically updates task progress based on transcript analysis, keeping documentation current without manual effort.

Craig's feedback was crucial - especially "check the sdk docs!" when I was stuck on the cwd issue, and "give it a lot more than 3 turns" when Claude wasn't using tools properly.
